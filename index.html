<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BATALHIGA - Final Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@400;600;700&display=swap');

        :root {
            --neon-blue: #00f2ff;
            --neon-gold: #ffd700;
            --neon-red: #ff0055;
            --neon-green: #00ff66;
            --neon-purple: #bd00ff;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: #05060a;
            color: #e2e8f0;
            overflow-x: hidden;
            touch-action: manipulation;
            transition: background 0.5s ease;
        }

        /* Cores Din√¢micas dos Eventos */
        body[data-event="DOUBLE"] { --neon-theme: var(--neon-blue); }
        body[data-event="TRIPLE"] { --neon-theme: var(--neon-gold); }
        body[data-event="THIEF"] { --neon-theme: var(--neon-red); }
        body[data-event="LIMIT"] { --neon-theme: #ff8800; }
        body[data-event="CHAOS"] { --neon-theme: #ff00ff; }
        body[data-event="BET"] { --neon-theme: #00ff00; }
        body[data-event="UNDERDOG"] { --neon-theme: #0088ff; }
        body[data-event="CAPITALIST"] { --neon-theme: #ffffff; }
        body[data-event="BLIND"] { --neon-theme: #444444; } /* Cinza Escuro */
        
        body:not([data-event]) { --neon-theme: var(--neon-blue); }

        .font-orbitron { font-family: 'Orbitron', sans-serif; }

        @keyframes shake {
            0%, 100% { transform: translate(0, 0); }
            20% { transform: translate(-8px, 0); }
            40% { transform: translate(8px, 0); }
            60% { transform: translate(-8px, 0); }
            80% { transform: translate(8px, 0); }
        }
        .apply-shake { animation: shake 0.4s ease-in-out; }

        .card-num {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: linear-gradient(145deg, #1e293b, #0f172a);
            -webkit-tap-highlight-color: transparent;
        }

        .card-num.revealed {
            background: var(--neon-theme);
            color: #000;
            box-shadow: 0 0 15px var(--neon-theme);
            border-color: #fff;
            transform: scale(0.92);
        }

        .active-player-border {
            border: 3px solid var(--neon-theme);
            background: rgba(0, 0, 0, 0.3);
            box-shadow: 0 0 15px var(--neon-theme);
        }

        .glass-effect {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .score-pill {
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
            border: 1px solid var(--neon-theme);
            color: var(--neon-theme);
        }

        /* Estilo BLIND MODE - Esconde Pontos */
        body[data-event="BLIND"] .score-pill {
            color: transparent !important;
            text-shadow: 0 0 8px rgba(255,255,255,0.5);
            position: relative;
        }
        body[data-event="BLIND"] .score-pill::after {
            content: "??";
            position: absolute;
            color: white;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .event-banner {
            animation: pulse-theme 2s infinite;
            border-color: var(--neon-theme);
            color: var(--neon-theme);
            background: rgba(0,0,0,0.4);
        }
        @keyframes pulse-theme {
            0% { box-shadow: 0 0 5px var(--neon-theme); }
            50% { box-shadow: 0 0 20px var(--neon-theme); }
            100% { box-shadow: 0 0 5px var(--neon-theme); }
        }

        /* FA√çSCAS / PARTICLES BG */
        .event-sparks {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            background-image: 
                radial-gradient(circle, var(--neon-theme) 1px, transparent 2px), 
                radial-gradient(circle, var(--neon-theme) 2px, transparent 3px);
            background-size: 60px 60px, 90px 90px;
            background-position: 0 0, 30px 30px;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        body[data-event] .event-sparks {
            opacity: 0.3;
            animation: floatingSparks 5s linear infinite;
        }
        @keyframes floatingSparks {
            0% { background-position: 0 0, 30px 30px; }
            100% { background-position: 0 60px, 30px 120px; }
        }

        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Estilos da Loja */
        .shop-btn {
            background: linear-gradient(to bottom, #2d3748, #1a202c);
            border: 1px solid #4a5568;
            transition: all 0.2s;
        }
        .shop-btn:active:not(:disabled) { transform: scale(0.95); }
        .shop-btn:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }

        /* Estilo da Tabela de Refer√™ncia */
        .ref-table-row {
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding: 8px 0;
        }
        .ref-table-row:last-child { border-bottom: none; }
        .ref-title { color: var(--neon-theme); font-weight: bold; font-size: 0.9rem; }
        .ref-content { color: #cbd5e1; font-size: 0.85rem; }

        /* Scrollbar customizada para hist√≥rico */
        .history-scroll::-webkit-scrollbar {
            width: 4px;
        }
        .history-scroll::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
        }
        .history-scroll::-webkit-scrollbar-thumb {
            background: var(--neon-theme);
            border-radius: 4px;
        }

        /* Toggle Switch Style */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #68D391;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #68D391;
        }

        /* Timer Bar */
        #timer-bar-container {
            width: 100%;
            height: 6px;
            background: #1e293b;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        #timer-bar-fill {
            height: 100%;
            background: var(--neon-theme);
            width: 100%;
            transition: width 1s linear;
        }

        /* Reveal Overlay */
        #reveal-overlay {
            background: radial-gradient(circle at center, #1a202c 0%, #000000 100%);
        }
        .reveal-name {
            animation: revealPop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            opacity: 0;
            transform: scale(0.5) translateY(20px);
        }
        @keyframes revealPop {
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

    </style>
</head>
<body class="min-h-screen p-4 flex flex-col items-center pb-20">

    <!-- Spark Effect Container -->
    <div class="event-sparks"></div>

    <header class="text-center mt-2 mb-4 w-full relative">
        <h1 class="text-5xl font-orbitron font-bold tracking-tighter" style="color: var(--neon-theme); text-shadow: 0 0 15px var(--neon-theme);">
            BATAL<span class="text-white">HIGA</span>
        </h1>
        <p class="text-slate-500 uppercase tracking-[0.3em] text-[10px] mt-1 font-bold">V-FINAL + UPDATES</p>
    </header>

    <main class="w-full max-w-lg flex flex-col gap-5 relative">
        
        <div id="event-display" class="hidden w-full border-2 p-3 rounded-xl text-center font-orbitron font-bold uppercase tracking-widest text-sm event-banner z-10 flex items-center justify-center">
            ‚ö† EVENTO: <span id="event-name" class="text-white ml-2"></span>
            <button onclick="showEventInfo()" class="ml-3 w-6 h-6 rounded-full border border-white text-white text-xs font-bold bg-white/10 active:scale-95 flex items-center justify-center">i</button>
        </div>

        <!-- POT DISPLAY FOR BET MODE -->
        <div id="pot-display" class="hidden w-full bg-green-900/50 border border-green-500 p-2 rounded-lg text-center text-green-400 font-bold mb-[-10px]">
            üí∞ POTE ACUMULADO: <span id="pot-amount" class="text-white text-xl ml-1">0</span> PTS
        </div>

        <!-- UNDERDOG INFO -->
        <div id="underdog-display" class="hidden w-full bg-blue-900/50 border border-blue-500 p-2 rounded-lg text-center text-blue-300 font-bold text-xs mb-[-10px]">
            üê¢ AZAR√ÉO ATIVO: <span id="underdog-name" class="text-white"></span> tem <span id="ud-bonus-desc">dicas extras</span>!
        </div>

        <!-- START SCREEN -->
        <div id="start-screen" class="glass-effect p-6 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-orbitron font-bold mb-4 text-white text-center uppercase tracking-widest border-b border-slate-700 pb-4">Manual de Jogo</h2>
            <div class="mb-6 p-4 bg-black/40 rounded-2xl text-slate-300 text-sm leading-relaxed text-justify h-48 overflow-y-auto history-scroll">
                
                <p class="mb-3 text-white font-bold border-b border-slate-700 pb-1">N√∫mero de jogadores:</p>
                <p class="mb-4 text-xs">2 a 4.</p>

                <p class="mb-3 text-white font-bold border-b border-slate-700 pb-1">Funcionamento por rodada:</p>
                <ul class="list-disc pl-4 space-y-1 text-xs mb-4">
                    <li>O jogo seleciona um elemento de liga aleat√≥rio.</li>
                    <li>Em cada rodada, h√° 20 bot√µes com 20 dicas.</li>
                    <li>Na sua vez, escolha uma das dicas dispon√≠veis.</li>
                    <li>Ap√≥s ver a dica, decida se vai arriscar o elemento de liga ou passar a vez.</li>
                    <li>Um jogador pode passar no m√°ximo 3 vezes durante o jogo.</li>
                </ul>

                <p class="mb-3 text-white font-bold border-b border-slate-700 pb-1">Ao arriscar:</p>
                <ul class="list-disc pl-4 space-y-1 text-xs mb-4">
                    <li><strong>Acertou:</strong> Ganha 1 ponto e inicia uma nova rodada (novo elemento).</li>
                    <li><strong>Errou:</strong> Perde 1 ponto e passa para o pr√≥ximo jogador.</li>
                </ul>

                <p class="mb-3 text-white font-bold border-b border-slate-700 pb-1">Fim do jogo:</p>
                <ul class="list-disc pl-4 space-y-1 text-xs">
                    <li>Um jogador chega a 10 pontos (Ou ativa o Ceifador).</li>
                    <li>OU Todos os outros jogadores chegam a 0 pontos, sobrando apenas 1.</li>
                </ul>
            </div>

            <div class="flex flex-col items-center gap-6">
                <div class="text-center">
                    <span class="text-xs uppercase font-bold text-slate-500 tracking-widest mb-3 block">Jogadores</span>
                    <div class="flex gap-4">
                        <button onclick="setPlayersCount(2)" id="btn-p2" class="p-btn w-14 h-14 rounded-xl bg-cyan-600 text-black font-bold text-xl">2</button>
                        <button onclick="setPlayersCount(3)" id="btn-p3" class="p-btn w-14 h-14 rounded-xl bg-slate-800 text-white font-bold text-xl">3</button>
                        <button onclick="setPlayersCount(4)" id="btn-p4" class="p-btn w-14 h-14 rounded-xl bg-slate-800 text-white font-bold text-xl">4</button>
                    </div>
                </div>
                <button onclick="showNamesScreen()" class="w-full bg-white text-black font-orbitron font-bold py-4 rounded-xl shadow-lg active:scale-95 text-lg uppercase">
                    Configurar
                </button>
            </div>
        </div>

        <!-- NAMES SCREEN -->
        <div id="names-screen" class="hidden glass-effect p-6 rounded-3xl animate-fade-in relative">
            <button onclick="backToStart()" class="absolute top-6 left-6 text-slate-400 hover:text-white text-xs font-bold uppercase tracking-widest flex items-center gap-1">
                ‚Üê Voltar
            </button>

            <h2 class="text-xl font-orbitron font-bold mb-4 text-center uppercase tracking-widest mt-6">Identifica√ß√£o</h2>
            <div id="names-container" class="flex flex-col gap-3 mb-6"></div>

            <!-- CONFIGURATION SECTION -->
            <div class="border-t border-slate-700 pt-4 mb-6">
                <h3 class="text-sm font-orbitron font-bold mb-3 text-center uppercase text-slate-400 tracking-widest">Regras da Partida</h3>
                
                <!-- TEMPO -->
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        <span class="text-xs font-bold text-white uppercase">‚è±Ô∏è Limite de Tempo</span>
                        <button onclick="showOptionInfo('tempo')" class="w-5 h-5 rounded-full bg-slate-700 text-[10px] font-bold text-white flex items-center justify-center">?</button>
                    </div>
                    <select id="config-timer" class="bg-slate-900 border border-slate-600 text-white text-xs p-2 rounded-lg outline-none w-28 text-center font-bold">
                        <option value="0">Sem Tempo</option>
                        <option value="15">15s</option>
                        <option value="30">30s</option>
                        <option value="45">45s</option>
                        <option value="60">60s</option>
                    </select>
                </div>

                <!-- MODO F√ÅCIL (MOVIDO PARA C√Å) -->
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        <span class="text-xs font-bold text-white uppercase">üë∂ Modo F√°cil</span>
                        <button onclick="showOptionInfo('easy')" class="w-5 h-5 rounded-full bg-slate-700 text-[10px] font-bold text-white flex items-center justify-center">?</button>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="config-easy" class="sr-only peer">
                        <div class="w-11 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div>
                    </label>
                </div>

                <!-- RANDOM ORDER -->
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        <span class="text-xs font-bold text-white uppercase">üé≤ Ordem Aleat√≥ria</span>
                        <button onclick="showOptionInfo('randomorder')" class="w-5 h-5 rounded-full bg-slate-700 text-[10px] font-bold text-white flex items-center justify-center">?</button>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="config-random-order" class="sr-only peer">
                        <div class="w-11 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-cyan-500"></div>
                    </label>
                </div>

                <!-- NO CONSULT -->
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        <span class="text-xs font-bold text-white uppercase">üö´ Sem Consulta</span>
                        <button onclick="showOptionInfo('noconsult')" class="w-5 h-5 rounded-full bg-slate-700 text-[10px] font-bold text-white flex items-center justify-center">?</button>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="config-no-consult" class="sr-only peer">
                        <div class="w-11 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-500"></div>
                    </label>
                </div>

                <!-- CEIFADOR -->
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        <span class="text-xs font-bold text-white uppercase">üíÄ Modo Ceifador</span>
                        <button onclick="showOptionInfo('ceifador')" class="w-5 h-5 rounded-full bg-slate-700 text-[10px] font-bold text-white flex items-center justify-center">?</button>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="config-reaper" class="sr-only peer">
                        <div class="w-11 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600"></div>
                    </label>
                </div>

                <!-- CAOS -->
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <span class="text-xs font-bold text-white uppercase">üåÄ Modo Caos</span>
                        <button onclick="showOptionInfo('caos')" class="w-5 h-5 rounded-full bg-slate-700 text-[10px] font-bold text-white flex items-center justify-center">?</button>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="config-chaos" class="sr-only peer">
                        <div class="w-11 h-6 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                    </label>
                </div>
            </div>

            <button onclick="tryStartGame()" class="w-full bg-cyan-600 text-white font-orbitron font-bold py-4 rounded-xl text-lg uppercase active:scale-95">
                Iniciar
            </button>
        </div>

        <!-- REVEAL ORDER SCREEN (Overlay) -->
        <div id="reveal-overlay" class="hidden fixed inset-0 z-50 flex flex-col items-center justify-center p-6 text-center">
            <h2 id="reveal-title" class="text-3xl font-orbitron font-bold text-cyan-400 mb-10 animate-pulse">DEFININDO ORDEM...</h2>
            <div id="reveal-container" class="flex flex-col gap-4 w-full max-w-sm">
                <!-- Names will be injected here -->
            </div>
        </div>

        <!-- GAME UI -->
        <div id="players-status" class="hidden grid grid-cols-2 gap-2"></div>

        <!-- TIMER BAR DISPLAY -->
        <div id="game-timer-wrapper" class="hidden px-2">
            <div class="flex justify-between text-[10px] text-slate-400 font-bold mb-1 uppercase">
                <span>Tempo do Turno</span>
                <span id="timer-text">--s</span>
            </div>
            <div id="timer-bar-container">
                <div id="timer-bar-fill"></div>
            </div>
        </div>

        <div id="game-screen" class="hidden flex flex-col gap-4">
            
            <!-- SHOP PANEL (CAPITALIST MODE) -->
            <div id="shop-panel" class="hidden glass-effect p-3 rounded-2xl border border-white/20">
                <div class="text-center text-xs font-bold uppercase text-slate-400 mb-2 tracking-widest">üõí Loja Capitalista (1 compra/turno)</div>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="shopBuy('skip')" class="shop-btn p-2 rounded text-[10px] text-white flex flex-col items-center">
                        <span class="font-bold text-red-400">ANULAR OPONENTE</span>
                        <span class="text-xs">1 Ponto</span>
                    </button>
                    <button onclick="shopBuy('clue')" class="shop-btn p-2 rounded text-[10px] text-white flex flex-col items-center">
                        <span class="font-bold text-yellow-400">+1 DICA EXTRA</span>
                        <span class="text-xs">1 Ponto</span>
                    </button>
                    <button onclick="shopBuy('pass')" class="shop-btn p-2 rounded text-[10px] text-white flex flex-col items-center">
                        <span class="font-bold text-blue-400">+1 PASSAR VEZ</span>
                        <span class="text-xs">2 Pontos</span>
                    </button>
                    <button onclick="shopBuy('change')" class="shop-btn p-2 rounded text-[10px] text-white flex flex-col items-center">
                        <span class="font-bold text-purple-400">MUDAR ELEMENTO</span>
                        <span class="text-xs">2 Pontos</span>
                    </button>
                </div>
            </div>

            <!-- GRID -->
            <div class="glass-effect p-4 rounded-3xl min-h-[200px] flex items-center justify-center">
                <div id="grid-pistas" class="grid grid-cols-4 gap-2 w-full"></div>
            </div>

            <!-- CLUE DISPLAY AREA -->
            <div class="flex flex-col gap-2">
                <div class="flex gap-2">
                    <div id="clue-display" class="flex-grow bg-slate-950 p-4 rounded-2xl border-2 text-center text-lg font-semibold text-white shadow-inner flex items-center justify-center leading-tight transition-colors" style="border-color: var(--neon-theme); min-height: 80px;">
                        Toque em um n√∫mero...
                    </div>
                    <button id="btn-ref-table" onclick="openRefTable()" class="w-16 bg-slate-800 border border-slate-600 rounded-2xl flex flex-col items-center justify-center text-white active:scale-95 shadow-lg">
                        <span class="text-2xl">üìò</span>
                        <span class="text-[8px] font-bold mt-1 uppercase">Tabela</span>
                    </button>
                </div>

                <!-- HIST√ìRICO DE DICAS -->
                <div id="history-container" class="glass-effect p-3 rounded-2xl border border-white/10 hidden">
                    <div class="text-[10px] uppercase font-bold text-slate-500 mb-2 tracking-widest border-b border-white/10 pb-1">Hist√≥rico de Dicas da Rodada</div>
                    <div id="clue-history-list" class="flex flex-col gap-2 max-h-32 overflow-y-auto history-scroll text-sm text-slate-300">
                        <!-- Hist√≥rico inserido via JS -->
                    </div>
                </div>
            </div>

            <!-- ACTIONS -->
            <div id="action-panel" class="glass-effect p-5 rounded-3xl flex flex-col gap-3">
                <select id="guess-input" class="w-full bg-slate-950 border border-slate-700 text-white p-3 rounded-xl text-lg outline-none focus:border-cyan-500">
                    <option value="" disabled selected>Selecionar elemento...</option>
                </select>
                <div class="grid grid-cols-1 gap-2">
                    <button onclick="checkGuess()" class="w-full text-black font-bold py-4 rounded-xl uppercase text-lg shadow-lg active:scale-[0.98] transition-all" style="background-color: var(--neon-theme);">Arriscar</button>
                    <button id="btn-pass" onclick="handlePass()" class="w-full bg-slate-800 text-white font-bold py-3 rounded-xl uppercase text-xs border border-slate-700 active:bg-slate-700">Passar Vez</button>
                </div>
            </div>
        </div>

        <!-- REFERENCE TABLE MODAL -->
        <div id="ref-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/95 p-4 backdrop-blur-md">
            <div class="bg-slate-900 border-2 border-white p-6 rounded-3xl w-full max-w-lg h-[80vh] flex flex-col animate-fade-in relative">
                <button onclick="closeRefTable()" class="absolute top-4 right-4 text-slate-400 hover:text-white text-xl font-bold">‚úï</button>
                
                <h3 class="text-xl font-orbitron font-bold text-white mb-4 uppercase text-center border-b border-slate-700 pb-4">Tabela de Consulta</h3>
                
                <div class="overflow-y-auto history-scroll flex-grow pr-2">
                    
                    <div class="ref-table-row">
                        <div class="ref-title">Aumento da resist√™ncia</div>
                        <div class="ref-content">Carbono (C), Mangan√™s (Mn), F√≥sforo (P), Sil√≠cio (Si), Van√°dio (V), Tungst√™nio (W)</div>
                    </div>

                    <div class="ref-table-row">
                        <div class="ref-title">Aumento da dureza</div>
                        <div class="ref-content">Carbono (C), Mangan√™s (Mn), F√≥sforo (P), Sil√≠cio (Si), Tungst√™nio (W)</div>
                    </div>

                    <div class="ref-table-row">
                        <div class="ref-title">Aumento da resist√™ncia ao impacto</div>
                        <div class="ref-content">N√≠quel (Ni), Cromo (Cr), Cobre (Cu)</div>
                    </div>

                    <div class="ref-table-row">
                        <div class="ref-title">Redu√ß√£o da ductilidade</div>
                        <div class="ref-content">Carbono (C), F√≥sforo (P), Enxofre (S)</div>
                    </div>

                    <div class="ref-table-row">
                        <div class="ref-title">Aumento da resist√™ncia em altas temperaturas</div>
                        <div class="ref-content">Cromo (Cr), Molibd√™nio (Mo), Van√°dio (V), Cobalto (Co)</div>
                    </div>

                    <div class="ref-table-row">
                        <div class="ref-title">Aumento da temperabilidade</div>
                        <div class="ref-content">N√≠quel (Ni), Cromo (Cr), Molibd√™nio (Mo)</div>
                    </div>

                    <div class="ref-table-row">
                        <div class="ref-title">A√ß√£o desoxidante</div>
                        <div class="ref-content">Mangan√™s (Mn), Sil√≠cio (Si), Alum√≠nio (Al)</div>
                    </div>

                    <div class="ref-table-row">
                        <div class="ref-title">Aumento da resist√™ncia √† corros√£o</div>
                        <div class="ref-content">Mangan√™s (Mn), F√≥sforo (P), Cromo (Cr), Molibd√™nio (Mo), Cobalto (Co), Tungst√™nio (W)</div>
                    </div>

                    <div class="ref-table-row">
                        <div class="ref-title">Aumento da resist√™ncia √† abras√£o</div>
                        <div class="ref-content">Cromo (Cr), Molibd√™nio (Mo)</div>
                    </div>

                    <div class="ref-table-row">
                        <div class="ref-title">Aumento da usinabilidade</div>
                        <div class="ref-content">F√≥sforo (P), Enxofre (S), Molibd√™nio (Mo), Chumbo (Pb)</div>
                    </div>

                    <div class="ref-table-row">
                        <div class="ref-title">Redu√ß√£o da soldabilidade</div>
                        <div class="ref-content">Carbono (C)</div>
                    </div>

                </div>
                
                <button onclick="closeRefTable()" class="w-full bg-slate-800 text-white font-bold py-3 rounded-xl mt-4 border border-slate-600">FECHAR</button>
            </div>
        </div>

        <!-- MODALS GENERICO -->
        <div id="generic-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-6 backdrop-blur-sm">
            <div class="bg-slate-900 border-2 border-white p-6 rounded-3xl w-full max-w-sm text-center animate-fade-in relative overflow-hidden">
                <div id="modal-icon" class="text-5xl mb-4 relative z-10">üîî</div>
                <h3 id="modal-title" class="text-xl font-orbitron font-bold text-white mb-2 uppercase relative z-10"></h3>
                <p id="modal-desc" class="text-slate-300 text-sm mb-6 relative z-10"></p>
                
                <!-- Input Area (Hidden by default) -->
                <div id="modal-input-area" class="hidden mb-4 relative z-10">
                    <input type="number" id="modal-number-input" class="bg-black border border-slate-600 text-white text-center text-2xl p-2 rounded-lg w-24" placeholder="0">
                </div>

                <div id="modal-actions" class="flex flex-col gap-2 relative z-10"></div>
            </div>
        </div>

        <div id="win-screen" class="hidden glass-effect p-10 rounded-[2rem] border-2 text-center shadow-[0_0_50px_rgba(255,255,255,0.1)]">
            <div id="win-icon" class="text-8xl mb-6">üèÜ</div>
            <h2 id="winner-title" class="text-3xl font-orbitron font-bold text-white mb-4 uppercase"></h2>
            <p id="win-message" class="text-sm text-slate-300 mb-8"></p>
            <button onclick="location.reload()" class="w-full bg-white text-black font-orbitron font-bold py-5 rounded-2xl text-xl hover:scale-105">REINICIAR</button>
        </div>
    </main>

    <script>
        // --- BANCO DE DADOS ATUALIZADO (Com Categoria 'PRIME' - Dicas Positivas e Obrigat√≥rias no In√≠cio) ---
        const database = {
            "Carbono": {
                "prime": ["Principal respons√°vel por transformar ferro em a√ßo", "Aumenta significativamente a resist√™ncia mec√¢nica", "Contribui fortemente para o aumento da dureza", "Reduz a ductilidade do material", "Est√° presente em praticamente todos os a√ßos", "√â o elemento de liga mais fundamental", "D√° a 'alma' ao metal", "Sem ele, n√£o existe a√ßo", "O mestre da dureza b√°sica."],
                "formal": ["Este elemento √© o principal respons√°vel por transformar ferro em a√ßo", "Pequenas quantidades j√° alteram drasticamente a dureza", "Aumenta significativamente a resist√™ncia mec√¢nica", "Contribui fortemente para o aumento da dureza", "Reduz a ductilidade do material", "Em excesso, torna o a√ßo mais fr√°gil", "Afeta diretamente a soldabilidade de forma negativa", "Est√° presente em praticamente todos os a√ßos", "Seu controle √© essencial em tratamentos t√©rmicos", "Atua como elemento endurecedor b√°sico", "Influencia a resist√™ncia ao desgaste", "N√£o aumenta a resist√™ncia √† abras√£o", "√â decisivo para a forma√ß√£o de martensita", "Quanto maior seu teor, mais dif√≠cil √© a usinagem", "N√£o melhora a resist√™ncia √† corros√£o", "N√£o atua como desoxidante principal", "√â o elemento de liga mais fundamental", "Est√° associado √† perda de tenacidade em altos teores", "Afeta o equil√≠brio entre dureza e ductilidade", "√â o primeiro elemento considerado no projeto de um a√ßo", "Geralmente piora o desempenho em altas temperaturas", "Est√° ligado ao aumento da resist√™ncia ao impacto apenas em baixos teores", "Controla o limite de escoamento", "Influencia diretamente a microestrutura", "Seu excesso pode causar trincas", "√â essencial, mas perigoso se mal dosado", "Interfere negativamente na soldagem", "Atua em quase todas as propriedades mec√¢nicas", "√â o elemento mais simples e mais importante", "Sem ele, n√£o existe a√ßo"], 
                "informal": ["Define se o a√ßo vira arame ou uma faca de corte.","√â o 'combust√≠vel' da t√™mpera.","Inimigo n√∫mero 1 do soldador.","D√° a 'alma' ao metal.","Respons√°vel por aquele fio de navalha duradouro.","Em n√≠veis baixos, √© f√°cil de amassar com a m√£o.","Faz o metal 'gritar' se resfriar r√°pido demais.","O elemento mais barato para ganhar for√ßa.","Muito abundante na natureza.","O mestre da dureza b√°sica."] 
            },
            "Mangan√™s": {
                "prime": ["Aumenta a resist√™ncia mec√¢nica", "Contribui para o aumento da dureza", "Atua como desoxidante no a√ßo l√≠quido", "Melhora a resist√™ncia √† corros√£o", "Tem papel importante na desoxida√ß√£o", "Fica mais resistente gra√ßas a sua a√ß√£o desoxidante."],
                "formal": ["Aumenta a resist√™ncia mec√¢nica", "Contribui para o aumento da dureza", "N√£o melhora a temperabilidade", "Atua como desoxidante no a√ßo l√≠quido", "Ajuda a neutralizar os efeitos do enxofre", "N√£o melhora a resist√™ncia ao desgaste", "N√£o contribui para a resist√™ncia √† abras√£o", "N√£o aumenta a resist√™ncia ao impacto", "N√£o reduz drasticamente a soldabilidade", "√â comum em a√ßos estruturais", "Melhora a qualidade metal√∫rgica do a√ßo", "Auxilia na remo√ß√£o de impurezas", "Atua em conjunto com o carbono", "Aumenta a resist√™ncia sem fragilizar tanto", "Ajuda no controle da microestrutura", "Melhora a resist√™ncia √† corros√£o", "Atua fortemente em tratamentos t√©rmicos", "Reduz defeitos causados pelo enxofre", "Melhora a homogeneidade do a√ßo", "√â um elemento de liga de baixo custo", "Muito usado em a√ßos comerciais", "Contribui para a resist√™ncia em aplica√ß√µes mec√¢nicas", "N√£o atua em altas temperaturas", "N√£o √© um elemento nobre", "Tem papel importante na desoxida√ß√£o", "Aumenta a resist√™ncia geral do a√ßo", "Atua na forma√ß√£o de solu√ß√µes s√≥lidas", "Melhora propriedades sem comprometer muito a ductilidade", "√â comum em quase todos os a√ßos carbono", "Atua mais como refor√ßo estrutural do que qu√≠mico"], 
                "informal": ["O faxineiro do a√ßo l√≠quido.","Segredo dos trilhos de trem pesados.","Fica mais resistente gra√ßas a sua a√ß√£o desoxidante.","Impede que o enxofre destrua a liga.","O bra√ßo direito do Carbono.","Brasil √© um dos maiores produtores.","Evita que o a√ßo vire 'biscoito' ao forjar.","Limpa o oxig√™nio na fabrica√ß√£o.","O elemento do equil√≠brio industrial.","Essencial para pontes e pr√©dios."] 
            },
            "F√≥sforo": {
                "prime": ["Aumenta a resist√™ncia mec√¢nica", "Contribui para o aumento da dureza", "Reduz significativamente a ductilidade", "√â considerado um elemento indesej√°vel em muitos a√ßos", "Pequenas quantidades j√° causam efeitos negativos", "Pode melhorar levemente a usinabilidade", "Melhora a resist√™ncia √† corros√£o", "Pode aumentar a resist√™ncia, mas com custo mec√¢nico"],
                "formal": ["Aumenta a resist√™ncia mec√¢nica", "Contribui para o aumento da dureza", "Reduz significativamente a ductilidade", "Prejudica a tenacidade", "Torna o a√ßo mais fr√°gil", "N√£o melhora a resist√™ncia ao impacto", "Pequenas quantidades j√° causam efeitos negativos", "√â considerado um elemento indesej√°vel em muitos a√ßos", "Pode melhorar levemente a usinabilidade", "N√£o prejudica a soldabilidade", "Melhora a resist√™ncia √† corros√£o", "Atua negativamente em aplica√ß√µes estruturais", "Aumenta a fragilidade a frio", "Seu controle √© rigoroso na siderurgia", "N√£o melhora a resist√™ncia ao desgaste", "Pode aumentar a resist√™ncia, mas com custo mec√¢nico", "N√£o atua como desoxidante", "Afeta negativamente tratamentos t√©rmicos", "Pode causar trincas", "√â tolerado apenas em pequenas quantidades", "Est√° associado a falhas fr√°geis", "Reduz a ductilidade", "N√£o melhora propriedades em altas temperaturas", "N√£o melhora a temperabilidade", "√â mais prejudicial do que ben√©fico", "√â dif√≠cil de remover do a√ßo", "Aumenta o risco de fratura", "Atua negativamente na integridade estrutural", "√â evitado em a√ßos de qualidade", "√â um elemento de controle cr√≠tico"], 
                "informal": ["O sal do a√ßo: um pouquinho ajuda, muito estraga.","Faz o metal quebrar como vidro no frio.","Um 'mal necess√°rio' em algumas receitas.","D√° brilho, mas tira a seguran√ßa.","O pesadelo dos engenheiros estruturais.","Muito comum em fertilizantes tamb√©m.","Aumenta a dureza de forma barata e perigosa.","O perigo silencioso da metalurgia.","Dif√≠cil de expulsar da liga.","Pode causar trincas fantasmas."] 
            },
            "Enxofre": {
                "prime": ["Reduz a ductilidade do a√ßo", "Melhora a usinabilidade", "Seu excesso compromete o a√ßo", "Aumenta a probabilidade de falhas", "√â evitado em a√ßos estruturais", "Tem cheiro de ovo podre na forma pura."],
                "formal": ["Reduz a ductilidade do a√ßo", "Prejudica a resist√™ncia mec√¢nica", "Aumenta a fragilidade", "Melhora a usinabilidade", "Forma inclus√µes indesej√°veis", "N√£o melhora a resist√™ncia ao impacto", "N√£o prejudica a soldabilidade", "√â considerado uma impureza", "Atua negativamente na tenacidade", "Pode causar trincas a quente", "N√£o melhora a resist√™ncia √† corros√£o", "Reduz a qualidade estrutural", "√â controlado rigorosamente", "Atua negativamente em aplica√ß√µes cr√≠ticas", "Pode ser neutralizado pelo mangan√™s", "N√£o melhora a dureza", "N√£o melhora a temperabilidade", "Aumenta a fragilidade intergranular", "√â tolerado apenas em a√ßos de f√°cil usinagem", "Prejudica o desempenho mec√¢nico geral", "N√£o atua como desoxidante", "Forma sulfetos fr√°geis", "Afeta negativamente tratamentos t√©rmicos", "Reduz a resist√™ncia ao impacto", "Aumenta a probabilidade de falhas", "N√£o melhora resist√™ncia ao desgaste", "Atua como elemento indesej√°vel", "Seu excesso compromete o a√ßo", "Est√° associado a defeitos metal√∫rgicos", "√â evitado em a√ßos estruturais"], 
                "informal": ["Tem cheiro de ovo podre na forma pura.","O queridinho de quem faz parafusos r√°pidos.","Faz o metal 'desfarelar' na usinagem.","Inimigo mortal da solda perfeita.","Causa trincas durante a forja (quente).","O lubrificante barato das ferramentas.","Se n√£o tiver Mangan√™s por perto, ele mata o a√ßo.","Vem muitas vezes do carv√£o e min√©rios.","Pequenas 'manchas' na estrutura interna.","O vil√£o da integridade mec√¢nica."] 
            },
            "Sil√≠cio": {
                "prime": ["Atua como desoxidante", "Aumenta a resist√™ncia mec√¢nica", "Contribui para o aumento da dureza", "Melhora a resist√™ncia √† corros√£o", "Aumenta a resist√™ncia √† oxida√ß√£o", "Melhora a resist√™ncia em ambientes agressivos", "Melhora a resist√™ncia √† oxida√ß√£o superficial", "Essencial para transformadores el√©tricos."],
                "formal": ["Atua como desoxidante", "Aumenta a resist√™ncia mec√¢nica", "Contribui para o aumento da dureza", "Melhora a resist√™ncia √† corros√£o", "Aumenta a resist√™ncia √† oxida√ß√£o", "N√£o reduz drasticamente a ductilidade", "Melhora propriedades el√°sticas", "Atua na limpeza do a√ßo", "√â comum em a√ßos estruturais", "Ajuda na qualidade metal√∫rgica", "Melhora a resist√™ncia em ambientes agressivos", "Atua positivamente na microestrutura", "N√£o melhora a usinabilidade", "N√£o prejudica fortemente a soldabilidade", "Aumenta a resist√™ncia geral", "Atua como elemento auxiliar", "Melhora a resist√™ncia ao envelhecimento", "√â usado em a√ßos el√©tricos", "N√£o melhora resist√™ncia ao impacto", "Contribui para estabilidade estrutural", "N√£o aumenta a resist√™ncia em altas temperaturas", "N√£o melhora a temperabilidade", "Atua na redu√ß√£o de impurezas", "Melhora propriedades f√≠sicas", "Atua sem causar fragilidade excessiva", "√â um elemento de liga comum", "Atua em baixos teores", "Melhora a resist√™ncia √† oxida√ß√£o superficial", "N√£o √© um elemento nobre", "Atua mais quimicamente do que mecanicamente"], 
                "informal": ["O mestre das molas.","Essencial para transformadores el√©tricos.","Vem basicamente da areia.","Faz o metal l√≠quido correr como √°gua.","O c√©rebro da eletr√¥nica moderna.","Tira as bolhas do metal derretido.","Garante que a faca dobre e n√£o quebre.","Protege o metal do oxig√™nio.","O elemento do flexibilidade.","D√° resist√™ncia sem ser pesado."] 
            },
            "N√≠quel": {
                "prime": ["Aumenta significativamente a resist√™ncia ao impacto", "Mant√©m boa ductilidade mesmo com alta resist√™ncia", "O metal das moedas.", "Elemento 'nobre' e caro.", "Usado em cordas de guitarra.", "O segredo dos motores de avi√£o.", "Traz a confian√ßa para pe√ßas que vibram muito.", "Faz o a√ßo inox ser tenaz e d√≥cil.", "Amigo da pancada pesada."],
                "formal": ["Aumenta significativamente a resist√™ncia ao impacto", "Melhora a tenacidade do a√ßo", "Mant√©m boa ductilidade mesmo com alta resist√™ncia", "N√£o contribui para a resist√™ncia mec√¢nica", "Atua positivamente em baixas temperaturas", "N√£o melhora a resist√™ncia √† corros√£o", "√â comum em a√ßos inoxid√°veis", "N√£o aumenta excessivamente a dureza", "Ajuda a evitar fraturas fr√°geis", "Atua na estabilidade da microestrutura", "Melhora a resist√™ncia √† fadiga", "N√£o prejudica severamente a soldabilidade", "Contribui para aplica√ß√µes estruturais cr√≠ticas", "√â usado quando se busca equil√≠brio mec√¢nico", "Atua melhor combinado com cromo", "N√£o melhora a usinabilidade", "Aumenta a resist√™ncia sem fragilizar", "Melhora o comportamento em impacto", "√â comum em a√ßos de alta tenacidade", "N√£o atua como desoxidante", "Atua em aplica√ß√µes criog√™nicas", "Melhora propriedades mec√¢nicas gerais", "N√£o melhora resist√™ncia √† abras√£o", "Contribui para estabilidade dimensional", "Atua mais mecanicamente do que quimicamente", "N√£o melhora a temperabilidade de forma dominante", "√â um elemento relativamente caro", "Associado a a√ßos de alto desempenho", "Melhora a vida √∫til do material", "Est√° ligado √† resist√™ncia e tenacidade"], 
                "informal": ["O metal das moedas.","Aguenta o frio do Alasca sem trincar.","D√° um brilho amarelado luxuoso.","Elemento 'nobre' e caro.","Usado em cordas de guitarra.","O segredo dos motores de avi√£o.","Traz a confian√ßa para pe√ßas que vibram muito.","Faz o a√ßo inox ser tenaz e d√≥cil.","Amigo da pancada pesada.","N√£o gosta de ser magn√©tico."] 
            },
            "Cromo": {
                "prime": ["Aumenta significativamente a resist√™ncia √† corros√£o", "Contribui para o aumento da dureza", "Melhora a resist√™ncia ao desgaste", "Atua fortemente em altas temperaturas", "Aumenta a resist√™ncia √† abras√£o", "Melhora a temperabilidade", "√â essencial em a√ßos inoxid√°veis", "Atua positivamente em tratamentos t√©rmicos", "Aumenta a resist√™ncia √† oxida√ß√£o", "Aumenta a resist√™ncia ao calor", "Aumenta a dureza sem depender s√≥ do carbono", "O rei do A√ßo Inox.", "Superf√≠cie muito dura.", "Inimigo do desgaste."],
                "formal": ["Aumenta significativamente a resist√™ncia √† corros√£o", "Contribui para o aumento da dureza", "Melhora a resist√™ncia ao desgaste", "Aumenta a resist√™ncia √† abras√£o", "Atua fortemente em altas temperaturas", "Melhora a temperabilidade", "Forma carbonetos duros", "√â essencial em a√ßos inoxid√°veis", "N√£o aumenta a resist√™ncia mec√¢nica", "Contribui para maior vida √∫til", "Melhora o desempenho em ambientes agressivos", "N√£o melhora a usinabilidade", "N√£o reduz a ductilidade", "Atua positivamente em tratamentos t√©rmicos", "Aumenta a resist√™ncia √† oxida√ß√£o", "Contribui para estabilidade microestrutural", "Atua tanto mecanicamente quanto quimicamente", "N√£o atua como desoxidante principal", "√â usado em ferramentas e moldes", "Aumenta a resist√™ncia ao calor", "Melhora resist√™ncia ao desgaste superficial", "N√£o dificulta a soldabilidade", "√â comum em a√ßos especiais", "Atua em aplica√ß√µes de alta exig√™ncia", "Melhora resist√™ncia qu√≠mica", "Aumenta a dureza sem depender s√≥ do carbono", "Contribui para resist√™ncia estrutural", "Atua em conjunto com n√≠quel", "Est√° associado √† prote√ß√£o contra corros√£o", "√â um dos elementos mais importantes de liga"], 
                "informal": ["Cria uma 'pele' invis√≠vel anti-ferrugem.","Famoso em torneiras e para-choques brilhantes.","O rei do A√ßo Inox.","Aguenta o fogo sem descascar.","Deixa a faca dif√≠cil de amolar, mas eterna.","Protege contra o lim√£o e a maresia.","O elemento do design e da higiene.","D√° o status 'premium' ao metal.","Superf√≠cie muito dura.","Inimigo do desgaste."] 
            },
            "Molibd√™nio": {
                "prime": ["Aumenta a resist√™ncia em altas temperaturas", "Melhora significativamente a temperabilidade", "Melhora a resist√™ncia √† corros√£o", "Aumenta a resist√™ncia ao desgaste", "√â usado em a√ßos de alta temperatura", "√â um elemento de liga nobre", "Est√° ligado a resist√™ncia t√©rmica e mec√¢nica", "O mestre do calor extremo.", "Elemento muito denso e pesado."],
                "formal": ["Aumenta a resist√™ncia em altas temperaturas", "Melhora significativamente a temperabilidade", "N√£o contribui para a resist√™ncia mec√¢nica", "Aumenta a resist√™ncia √† flu√™ncia", "Melhora a resist√™ncia √† corros√£o", "Atua fortemente em a√ßos de alta performance", "Evita fragiliza√ß√£o em servi√ßo", "Melhora o desempenho sob carga cont√≠nua", "Atua em conjunto com cromo", "Aumenta a resist√™ncia ao desgaste", "Melhora a usinabilidade", "N√£o reduz a ductilidade", "Contribui para estabilidade t√©rmica", "Melhora resist√™ncia √† fadiga", "Atua em aplica√ß√µes cr√≠ticas", "N√£o atua como desoxidante", "Aumenta a vida √∫til do material", "√â usado em a√ßos de alta temperatura", "Contribui para resist√™ncia qu√≠mica", "Melhora a resist√™ncia estrutural", "Atua em ambientes severos", "N√£o aumenta a resist√™ncia mec√¢nica sem depender do carbono", "√â um elemento de liga nobre", "Melhora comportamento em servi√ßo prolongado", "Atua contra a fragiliza√ß√£o por revenido", "Aumenta a confiabilidade do a√ßo", "√â comum em a√ßos ligados especiais", "Atua fortemente em tratamentos t√©rmicos", "Contribui para desempenho extremo", "Est√° ligado a resist√™ncia t√©rmica e mec√¢nica"], 
                "informal": ["O mestre do calor extremo.","Favorito para chassis de carros de corrida (Chromoly).","Segura as pontas quando o metal fica vermelho.","Usado em brocas que furam metal grosso.","Pe√ßas de petr√≥leo no fundo do mar.","O refor√ßo invis√≠vel das ligas de elite.","Elemento muito denso e pesado.","Evita que o a√ßo amole√ßa no trabalho duro.","Aliado das altas press√µes.","O bra√ßo forte da engenharia moderna."] 
            },
            "Van√°dio": {
                "prime": ["Aumenta significativamente a resist√™ncia mec√¢nica", "Melhora a resist√™ncia estrutural", "Melhora propriedades mec√¢nicas gerais", "Contribui para resist√™ncia em altas temperaturas", "Est√° ligado √† alta resist√™ncia", "S√≠mbolo gravado nas melhores chaves de boca.", "Permite fazer ferramentas finas e indestrut√≠veis."],
                "formal": ["Aumenta significativamente a resist√™ncia mec√¢nica", "N√£o contribui para o aumento da dureza", "Forma carbonetos muito duros", "N√£o melhora a resist√™ncia ao desgaste", "N√£o aumenta a resist√™ncia √† abras√£o", "Atua na refina√ß√£o do gr√£o", "Melhora a resist√™ncia estrutural", "Contribui para maior limite de escoamento", "Atua fortemente em a√ßos ferramenta", "Melhora a estabilidade microestrutural", "N√£o melhora a usinabilidade", "N√£o reduz a ductilidade", "Atua positivamente em tratamentos t√©rmicos", "Aumenta a vida √∫til do material", "Contribui para resist√™ncia √† fadiga", "Atua em aplica√ß√µes de alta exig√™ncia", "N√£o atua como desoxidante principal", "N√£o aumenta a resist√™ncia ao desgaste superficial", "Melhora propriedades mec√¢nicas gerais", "Atua em conjunto com cromo", "Contribui para resist√™ncia em altas temperaturas", "√â comum em a√ßos microligados", "Melhora desempenho sob carga", "Atua como refor√ßo estrutural", "N√£o melhora resist√™ncia √† corros√£o", "Contribui para microestrutura mais fina", "Atua fortemente na resist√™ncia em altas temperaturas", "√â usado em pequenas quantidades", "Melhora confiabilidade do a√ßo", "Est√° ligado √† alta resist√™ncia"], 
                "informal": ["S√≠mbolo gravado nas melhores chaves de boca.","D√° ao a√ßo um corte 'agressivo'.","Refina os gr√£os internos como um microsc√≥pio.","O metal do torque infinito.","Permite fazer ferramentas finas e indestrut√≠veis.","Nome inspirado em uma deusa n√≥rdica.","Inimigo da fadiga mec√¢nica.","Traz a 'confian√ßa' ao mec√¢nico profissional.","O toque final das ligas especiais.","D√° longevidade extrema ao fio."] 
            },
            "Alum√≠nio": {
                "prime": ["Atua como desoxidante", "Aumenta a resist√™ncia √† oxida√ß√£o", "Melhora resist√™ncia superficial √† oxida√ß√£o", "Famoso por latinhas e avi√µes.", "O metal mais leve da lista.", "Recicl√°vel infinitas vezes.", "O elemento mais abundante na crosta da Terra.", "Aparece em quase tudo, da cozinha ao foguete."],
                "formal": ["Atua como desoxidante", "Melhora a limpeza do a√ßo", "Contribui para refino de gr√£o", "Aumenta a resist√™ncia √† oxida√ß√£o", "Melhora estabilidade metal√∫rgica", "Atua em pequenas quantidades", "N√£o aumenta significativamente a dureza", "N√£o melhora resist√™ncia mec√¢nica diretamente", "Melhora propriedades qu√≠micas", "Atua no controle de inclus√µes", "Melhora a qualidade estrutural", "N√£o melhora a usinabilidade", "N√£o prejudica fortemente a ductilidade", "Atua na estabilidade microestrutural", "√â usado como elemento auxiliar", "N√£o melhora resist√™ncia ao desgaste", "Atua em a√ßos calmados", "Melhora resist√™ncia superficial √† oxida√ß√£o", "N√£o melhora resist√™ncia ao impacto", "Atua no controle metal√∫rgico", "√â essencial na produ√ß√£o de a√ßo limpo", "Atua quimicamente mais do que mecanicamente", "N√£o melhora temperabilidade", "√â comum em processos sider√∫rgicos", "N√£o melhora resist√™ncia √† corros√£o geral", "Atua na preven√ß√£o de defeitos", "Contribui para qualidade do material", "N√£o atua em altas temperaturas", "√â um elemento leve e reativo", "Atua nos bastidores da resist√™ncia"], 
                "informal": ["Famoso por latinhas e avi√µes.","O metal mais leve da lista.","Tira o oxig√™nio 'na marra' da fabrica√ß√£o.","Recicl√°vel infinitas vezes.","Aparece em quase tudo, da cozinha ao foguete.","Reflete o calor como um espelho.","O elemento mais abundante na crosta da Terra.","Acalma o banho de metal fervente.","Protege√ß√£o branca e fosca.","O guardi√£o da pureza do a√ßo."] 
            },
            "Cobalto": {
                "prime": ["Aumenta a resist√™ncia em altas temperaturas", "Melhora a resist√™ncia ao calor", "Contribui para estabilidade t√©rmica", "Melhora a resist√™ncia √† corros√£o", "Contribui para desempenho t√©rmico", "Aumenta confiabilidade em altas temperaturas", "A 'cola' que segura o tungst√™nio nas brocas.", "Usado em turbinas de avi√µes a jato."],
                "formal": ["Aumenta a resist√™ncia em altas temperaturas", "Melhora a resist√™ncia ao calor", "Atua em a√ßos de alta performance", "Contribui para estabilidade t√©rmica", "Melhora propriedades mec√¢nicas em servi√ßo quente", "Melhora a resist√™ncia √† corros√£o", "N√£o atua como desoxidante", "√â usado em a√ßos especiais", "Melhora desempenho em ferramentas", "Atua em aplica√ß√µes extremas", "Aumenta a dureza a quente", "Contribui para resist√™ncia estrutural", "N√£o melhora usinabilidade", "N√£o reduz a ductilidade", "Atua em conjunto com tungst√™nio", "Melhora resist√™ncia ao revenido", "Contribui para desempenho t√©rmico", "√â relativamente raro", "Aumenta confiabilidade em altas temperaturas", "Atua mais termicamente do que mecanicamente", "N√£o melhora resist√™ncia ao impacto", "Atua em a√ßos r√°pidos", "Contribui para estabilidade dimensional", "N√£o melhora soldabilidade", "Atua em aplica√ß√µes industriais severas", "Aumenta a vida √∫til em calor", "N√£o melhora resist√™ncia √† abras√£o", "√â um elemento de liga caro", "Atua em ferramentas de corte", "Est√° ligado a desempenho em altas temperaturas"], 
                "informal": ["D√° uma cor azul profunda maravilhosa.","A 'cola' que segura o tungst√™nio nas brocas.","Essencial para √≠m√£s superpoderosos.","Usado em turbinas de avi√µes a jato.","Aguenta o atrito que derreteria outros metais.","Elemento de minera√ß√£o perigosa e rara.","N√£o deixa o a√ßo 'relaxar' no calor.","Superligas espaciais amam ele.","O metal do desempenho extremo.","√çntimo dos cortes cir√∫rgicos industriais."] 
            },
            "Chumbo": {
                "prime": ["Melhora significativamente a usinabilidade", "Prejudica propriedades mec√¢nicas", "√â t√≥xico", "Est√° ligado exclusivamente √† usinabilidade", "O metal mais macio e pesado.", "O pesadelo ecol√≥gico se mal usado."],
                "formal": ["Melhora significativamente a usinabilidade", "Facilita o corte e a remo√ß√£o de cavaco", "N√£o melhora resist√™ncia mec√¢nica", "N√£o aumenta a dureza", "N√£o reduz a soldabilidade", "Prejudica propriedades mec√¢nicas", "Atua negativamente na resist√™ncia estrutural", "√â usado apenas em aplica√ß√µes espec√≠ficas", "N√£o melhora resist√™ncia ao impacto", "Atua como lubrificante interno", "N√£o reduz a ductilidade", "N√£o melhora resist√™ncia √† corros√£o", "Atua apenas em pequenas quantidades", "√â t√≥xico", "N√£o atua em tratamentos t√©rmicos", "Melhora produtividade de usinagem", "Prejudica a tenacidade", "N√£o melhora resist√™ncia ao desgaste", "√â usado em a√ßos de f√°cil usinagem", "N√£o atua como desoxidante", "Pode causar problemas metal√∫rgicos", "Reduz qualidade estrutural", "Atua apenas para fabrica√ß√£o", "N√£o melhora resist√™ncia em altas temperaturas", "√â evitado em a√ßos estruturais", "Atua mais no processo do que no produto final", "N√£o melhora propriedades mec√¢nicas", "Facilita fabrica√ß√£o em s√©rie", "√â um elemento controverso", "Est√° ligado exclusivamente √† usinabilidade"], 
                "informal": ["O metal mais macio e pesado.","Protege voc√™ no dentista (Raio-X).","O pesadelo ecol√≥gico se mal usado.","Faz a broca deslizar como se fosse manteiga.","Derrete at√© no fog√£o de casa.","N√£o deixa o sino tocar (abafa o som).","O rei da produtividade barata.","Muito denso, pouco resistente.","Pesa na balan√ßa, mas n√£o na dureza.","O 'mordomo' do torneiro mec√¢nico."] 
            },
            "Cobre": {
                "prime": ["Atua contra impactos", "Est√° ligado √† resist√™ncia ao impacto", "Ingrediente secreto do bronze e lat√£o.", "Cor avermelhada cl√°ssica.", "Rei dos fios el√©tricos.", "Protege o metal do impacto.", "O primeiro metal que a humanidade dominou.", "Mata bact√©rias por contato."],
                "formal": ["N√£o melhora a resist√™ncia √† corros√£o", "Atua contra impactos", "Contribui para durabilidade do a√ßo", "N√£o aumenta significativamente a dureza", "N√£o melhora resist√™ncia ao desgaste", "Atua em pequenas quantidades", "N√£o reduz a ductilidade", "N√£o melhora resist√™ncia em ambientes externos", "N√£o melhora a temperabilidade", "N√£o atua como desoxidante", "Pode causar fragiliza√ß√£o a quente", "√â usado em a√ßos patin√°veis", "Aumenta a vida √∫til estrutural", "Atua quimicamente", "Melhora a resist√™ncia ao impacto", "Contribui para estabilidade qu√≠mica", "N√£o melhora usinabilidade", "N√£o atua contra oxida√ß√£o superficial", "N√£o melhora resist√™ncia em altas temperaturas", "Atua em conjunto com n√≠quel", "N√£o melhora resist√™ncia ambiental", "N√£o melhora soldabilidade", "√â comum em a√ßos expostos", "Atua sem grandes mudan√ßas mec√¢nicas", "Contribui para resist√™ncia ao impacto", "N√£o aumenta resist√™ncia mec√¢nica geral", "Atua na durabilidade", "N√£o forma carbonetos duros", "Atua mais quimicamente que estruturalmente", "Est√° ligado √† resist√™ncia ao impacto"], 
                "informal": ["Rei dos fios el√©tricos.","Cria aquela ferrugem 'bonita' mas n√£o protetora.","Cor avermelhada cl√°ssica.","Mata bact√©rias por contato.","O primeiro metal que a humanidade dominou.","Faz o a√ßo aguentar impactos por d√©cadas.","O metal das moedas antigas e est√°tuas.","Excelente para espalhar o calor.","Ingrediente secreto do bronze e lat√£o.","Protege o metal do impacto."] 
            },
            "Tungst√™nio": {
                "prime": ["Aumenta significativamente a dureza", "Mant√©m dureza a quente", "Aumenta a resist√™ncia mec√¢nica", "Reduz a ductilidade", "Aumenta resist√™ncia estrutural", "Melhora a resist√™ncia √† corros√£o", "Atua em a√ßos ferramenta", "√â um elemento pesado", "Atua onde a dureza √© extrema", "√â s√≠mbolo de dureza e resist√™ncia", "O metal mais dif√≠cil de derreter do universo.", "Pesado quase como o ouro.", "Sin√¥nimo de dureza extrema."],
                "formal": ["Aumenta significativamente a dureza", "N√£o melhora a resist√™ncia ao desgaste", "N√£o aumenta a resist√™ncia √† abras√£o", "N√£o atua fortemente em altas temperaturas", "Mant√©m dureza a quente", "√â essencial em a√ßos r√°pidos", "Forma carbonetos extremamente duros", "Aumenta a resist√™ncia mec√¢nica", "Contribui para ferramentas de corte", "Melhora resist√™ncia ao revenido", "N√£o melhora usinabilidade", "Reduz a ductilidade", "Atua em aplica√ß√µes extremas", "Melhora estabilidade t√©rmica", "Contribui para longa vida √∫til", "N√£o atua como desoxidante", "Aumenta resist√™ncia estrutural", "Atua em conjunto com cobalto", "N√£o melhora desempenho sob calor intenso", "Melhora a resist√™ncia √† corros√£o", "Atua em a√ßos ferramenta", "Contribui para dureza profunda", "Atua fortemente em tratamentos t√©rmicos", "√â um elemento pesado", "Aumenta custo do a√ßo", "Atua onde a dureza √© extrema", "N√£o melhora resist√™ncia ao desgaste severo", "Mant√©m propriedades em servi√ßo pesado", "Est√° ligado a aplica√ß√µes industriais cr√≠ticas", "√â s√≠mbolo de dureza e resist√™ncia"], 
                "informal": ["O metal mais dif√≠cil de derreter do universo.","Ponta das brocas que furam parede (V√≠dia).","Filamento de l√¢mpadas que brilham forte.","Pesado quase como o ouro.","O rei do corte industrial (A√ßo R√°pido).","Alian√ßas que nunca riscam.","O seguran√ßa que n√£o sai do lugar no calor.","'Come' o esmeril se voc√™ tentar lixar.","Conhecido como Wolfram.","Sin√¥nimo de dureza extrema."] 
            }
        };

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playClick() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(600, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.08, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        function playError() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }

        let numPlayers = 2;
        let players = [];
        let currentPlayerIdx = 0;
        let currentElement = "";
        let currentDicas = [];
        let playerActionTaken = false;
        let currentEvent = null;
        let isFirstRound = true;
        let turnClicks = 0; 
        
        // GLOBAL PARA CONTROLAR REPETI√á√ÉO
        let elementUsageCount = {};

        // Estado dos Novos Eventos
        let betPot = 0;
        let underdogId = null;
        let underdogClicks = 0;
        let shopActionUsed = false;
        let skipNextPlayerId = null;

        // CONFIGURA√á√ïES GLOBAIS
        let configTimer = 0; // 0 = off
        let configReaper = false;
        let configChaos = false;
        let configRandomOrder = false;
        let configNoConsult = false;
        let configEasyMode = false;
        
        // ESTADO DO TIMER
        let timerInterval = null;
        let timeLeft = 0;

        // Descri√ß√µes dos eventos para o bot√£o info
        const eventDescriptions = {
            'DOUBLE': 'PONTOS DOBRADOS (x2): Se acertar, ganha 2 pontos!',
            'TRIPLE': 'PONTOS TRIPLICADOS (x3): Se acertar, ganha 3 pontos!',
            'THIEF': 'RODADA DO LADR√ÉO: Acertou? Rouba 1 ponto. Errou? D√° 1 ponto.',
            'LIMIT': 'LIMITE DE DICAS: Apenas 5 dicas dispon√≠veis nesta rodada.',
            'CHAOS': 'ORDEM ALEAT√ìRIA: A vez n√£o segue a ordem normal dos jogadores.',
            'BET': 'MODO APOSTA: O vencedor leva o pote acumulado!',
            'UNDERDOG': 'AZAR√ÉO NO COMANDO: O √∫ltimo colocado tem dicas extras!',
            'CAPITALIST': 'LOJA ABERTA: Compre poderes especiais com seus pontos.',
            'BLIND': 'RODADA CEGA: Pontos ocultos e as dicas somem ao passar a vez! Mem√≥ria √© tudo.'
        };

        const optionDescriptions = {
            'tempo': 'Ao selecionar essa op√ß√£o, o turno √© limitado. Se o tempo acabar, o jogador perde 3 pontos e passa a vez!',
            'ceifador': 'Quando um player chegar a 10 pontos, ele deve ELIMINAR um oponente para continuar jogando (volta para 5 pontos).',
            'caos': 'Modo em que TODAS as rodadas s√£o especiais (Inclusive a primeira)! Prepare-se para a bagun√ßa.',
            'noconsult': 'Remove o bot√£o da Tabela de Consulta durante o jogo. Para quem manja de verdade!',
            'randomorder': 'Em vez de seguir a ordem de cadastro (P1, P2...), o jogo embaralha e decide quem come√ßa e a sequ√™ncia dos turnos.',
            'easy': 'MODO F√ÅCIL: Permite desbloquear 3 dicas por turno. Uma ajuda extra para quem precisa!'
        };

        // Refer√™ncia e Hist√≥rico
        function openRefTable() {
            playClick();
            document.getElementById('ref-modal').classList.remove('hidden');
        }
        function closeRefTable() {
            playClick();
            document.getElementById('ref-modal').classList.add('hidden');
        }

        function showOptionInfo(type) {
            playClick();
            const modal = document.getElementById('generic-modal');
            const title = document.getElementById('modal-title');
            const desc = document.getElementById('modal-desc');
            const actions = document.getElementById('modal-actions');
            const icon = document.getElementById('modal-icon');
            const inputArea = document.getElementById('modal-input-area');

            modal.classList.remove('hidden');
            inputArea.classList.add('hidden');
            
            icon.innerText = "‚ÑπÔ∏è";
            title.innerText = "INFO DA REGRA";
            desc.innerText = optionDescriptions[type] || "Sem descri√ß√£o.";
            actions.innerHTML = `<button onclick="document.getElementById('generic-modal').classList.add('hidden')" class="w-full bg-slate-700 text-white font-bold py-3 rounded-xl">ENTENDI</button>`;
        }

        function setPlayersCount(num) {
            playClick();
            numPlayers = num;
            document.querySelectorAll('.p-btn').forEach(b => {
                b.classList.replace('bg-cyan-600', 'bg-slate-800');
                b.classList.replace('text-black', 'text-white');
            });
            document.getElementById(`btn-p${num}`).classList.replace('bg-slate-800', 'bg-cyan-600');
            document.getElementById(`btn-p${num}`).classList.replace('text-white', 'text-black');
        }

        function showNamesScreen() {
            playClick();
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('names-screen').classList.remove('hidden');
            const container = document.getElementById('names-container');
            container.innerHTML = "";
            for(let i=1; i<=numPlayers; i++) {
                container.innerHTML += `
                    <div class="flex flex-col gap-1">
                        <label class="text-[10px] uppercase font-bold text-slate-500 ml-1">Jogador ${i}</label>
                        <input type="text" id="name-p${i}" placeholder="Nome" class="bg-slate-900 border border-slate-700 p-3 rounded-xl outline-none focus:border-cyan-500 text-white font-bold">
                    </div>`;
            }
        }

        function backToStart() {
            playClick();
            document.getElementById('names-screen').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
        }

        async function tryStartGame() {
            playClick();
            
            // Ler Configura√ß√µes
            configTimer = parseInt(document.getElementById('config-timer').value);
            configReaper = document.getElementById('config-reaper').checked;
            configChaos = document.getElementById('config-chaos').checked;
            configRandomOrder = document.getElementById('config-random-order').checked;
            configNoConsult = document.getElementById('config-no-consult').checked;
            configEasyMode = document.getElementById('config-easy').checked; // L√™ modo f√°cil

            // Coletar Players
            players = [];
            const colors = ['#00f2ff', '#ffd700', '#ff0055', '#00ff66'];
            for(let i=1; i<=numPlayers; i++) {
                let name = document.getElementById(`name-p${i}`).value.trim().toUpperCase() || `P${i}`;
                players.push({ 
                    id: i, 
                    name: name, 
                    score: 5, 
                    active: true, 
                    passes: 3, 
                    color: colors[i-1] 
                });
            }

            document.getElementById('names-screen').classList.add('hidden');
            
            if (configRandomOrder) {
                await revealRandomOrder();
            } else {
                actualStartGame();
            }
        }

        function revealRandomOrder() {
            return new Promise(resolve => {
                players.sort(() => Math.random() - 0.5);

                const overlay = document.getElementById('reveal-overlay');
                const container = document.getElementById('reveal-container');
                const title = document.getElementById('reveal-title');

                overlay.classList.remove('hidden');
                container.innerHTML = "";
                title.innerText = "DEFININDO ORDEM...";

                let delay = 1000;

                players.forEach((p, index) => {
                    setTimeout(() => {
                        playClick();
                        const div = document.createElement('div');
                        div.className = "reveal-name bg-slate-800 border border-cyan-500 p-4 rounded-xl text-white font-bold text-xl uppercase shadow-[0_0_20px_rgba(0,242,255,0.3)]";
                        div.innerText = `${index + 1}¬∫ - ${p.name}`;
                        container.appendChild(div);
                    }, delay);
                    delay += 1000;
                });

                setTimeout(() => {
                    title.innerText = "JOGO INICIANDO!";
                    title.classList.add('text-green-400');
                    playClick();
                }, delay);

                setTimeout(() => {
                    overlay.classList.add('hidden');
                    actualStartGame();
                    resolve();
                }, delay + 1500);
            });
        }

        function actualStartGame() {
            if (configNoConsult) {
                document.getElementById('btn-ref-table').classList.add('hidden');
            } else {
                document.getElementById('btn-ref-table').classList.remove('hidden');
            }

            isFirstRound = true;
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('players-status').classList.remove('hidden');
            
            if (configTimer > 0) {
                document.getElementById('game-timer-wrapper').classList.remove('hidden');
            } else {
                document.getElementById('game-timer-wrapper').classList.add('hidden');
            }
            
            initRound();
        }

        function initRound(keepPlayer = false) {
            // Reset States
            currentEvent = null;
            betPot = 0;
            underdogId = null;
            underdogClicks = 0;
            shopActionUsed = false;
            skipNextPlayerId = null;
            
            // Limpa hist√≥rico visual
            document.getElementById('clue-history-list').innerHTML = "";
            document.getElementById('history-container').classList.add('hidden');

            document.getElementById('pot-display').classList.add('hidden');
            document.getElementById('underdog-display').classList.add('hidden');
            document.getElementById('shop-panel').classList.add('hidden');
            document.body.removeAttribute('data-event');

            // --- L√ìGICA DE EVENTOS ---
            let shouldTriggerEvent = false;

            if (configChaos) {
                shouldTriggerEvent = true;
            } else {
                if (isFirstRound) {
                    isFirstRound = false;
                    shouldTriggerEvent = false;
                } else if (Math.random() < 0.40) {
                    shouldTriggerEvent = true;
                }
            }

            if (shouldTriggerEvent) {
                const pool = ['DOUBLE', 'TRIPLE', 'THIEF', 'LIMIT', 'CHAOS', 'CAPITALIST', 'BLIND'];
                const activePlayers = players.filter(p => p.active);
                
                const scores = activePlayers.map(p => p.score);
                const minScore = Math.min(...scores);
                const countMin = scores.filter(s => s === minScore).length;
                if (countMin === 1) {
                    pool.push('UNDERDOG');
                }

                const hasCriticalScore = activePlayers.some(p => p.score <= 1);
                if (!hasCriticalScore) {
                    pool.push('BET');
                }

                currentEvent = pool[Math.floor(Math.random() * pool.length)];
            }

            if (currentEvent) {
                document.body.setAttribute('data-event', currentEvent);
                
                if (currentEvent === 'BET') {
                    openBetModal();
                    return; 
                }

                if (currentEvent === 'UNDERDOG') {
                    const activePlayers = players.filter(p => p.active);
                    const minScore = Math.min(...activePlayers.map(p => p.score));
                    const udPlayer = activePlayers.find(p => p.score === minScore);
                    underdogId = udPlayer.id;
                    document.getElementById('underdog-display').classList.remove('hidden');
                    document.getElementById('underdog-name').innerText = udPlayer.name;
                    // Atualiza texto do Azar√£o baseado no modo f√°cil
                    const bonusText = configEasyMode ? "4 DICAS" : "2 DICAS";
                    document.getElementById('ud-bonus-desc').innerText = bonusText;
                }

                if (currentEvent === 'CAPITALIST') {
                    document.getElementById('shop-panel').classList.remove('hidden');
                }
            }
            
            finishInitRound(keepPlayer);
        }

        function finishInitRound(keepPlayer) {
            updateEventUI();

            // REPOPULA A LISTA DE ELEMENTOS
            const select = document.getElementById('guess-input');
            select.innerHTML = `<option value="" disabled selected>Selecionar elemento...</option>`;
            Object.keys(database).sort().forEach(el => select.innerHTML += `<option value="${el}">${el}</option>`);

            // --- L√ìGICA INTELIGENTE DE SELE√á√ÉO (COM PESOS) ---
            const elNames = Object.keys(database);
            let weightedList = [];

            elNames.forEach(el => {
                const count = elementUsageCount[el] || 0;
                // Peso: Se nunca foi usado (0) = peso 10. Se j√° foi usado (>0) = peso 1.
                // Isso garante alta chance de novos, mas n√£o impossibilita repetidos.
                const weight = (count === 0) ? 10 : 1; 
                for(let w=0; w<weight; w++) {
                    weightedList.push(el);
                }
            });

            currentElement = weightedList[Math.floor(Math.random() * weightedList.length)];
            // Incrementa contagem de uso
            elementUsageCount[currentElement] = (elementUsageCount[currentElement] || 0) + 1;
            
            const data = database[currentElement];
            
            // --- NOVA L√ìGICA DE PROBABILIDADE + LIMPEZA ---
            
            // 1. Criar e limpar os Pools
            let primePool = [...data.prime];
            let normalPool = [...data.formal, ...data.informal];

            // REMOVE DICAS DUPLICADAS: Se uma dica normal for igual a qualquer prime, remove da normal.
            normalPool = normalPool.filter(clue => !primePool.includes(clue));

            // Embaralha para aleatoriedade
            primePool.sort(() => Math.random() - 0.5);
            normalPool.sort(() => Math.random() - 0.5);

            let totalNeeded = (currentEvent === 'LIMIT') ? 5 : 20;
            currentDicas = [];
            let primesPicked = 0;

            const hardElements = ["Tungst√™nio", "Van√°dio", "Cromo"];
            const isHardElement = hardElements.includes(currentElement);

            for (let i = 0; i < totalNeeded; i++) {
                let probability = 0;

                if (i === 0) {
                    probability = 1.0; // 100% para a PRIMEIRA dica (Obrigat√≥ria)
                } else if (isHardElement && i === 1) {
                    // EXCE√á√ÉO OCULTA: Elementos dif√≠ceis t√™m a segunda dica como 100% Prime
                    probability = 1.0; 
                } else {
                    // L√≥gica de Probabilidade Progressiva
                    if (primesPicked === 1) probability = 0.7;      // Procurando a 2¬™ Prime (70%)
                    else if (primesPicked === 2) probability = 0.5; // Procurando a 3¬™ Prime (50%)
                    else probability = 0.3;                         // Procurando a 4¬™+ Prime (30% estagnado)
                }

                // Tenta selecionar Prime baseado na probabilidade
                let usePrime = Math.random() < probability;

                // Fallback se faltar dicas no pool escolhido
                if (usePrime && primePool.length === 0) usePrime = false;
                if (!usePrime && normalPool.length === 0) usePrime = true;
                
                // Seguran√ßa final (caso n√£o tenha mais nenhuma dica, para o loop)
                if (usePrime && primePool.length === 0) break; 
                if (!usePrime && normalPool.length === 0) break;

                if (usePrime) {
                    currentDicas.push(primePool.pop());
                    primesPicked++;
                } else {
                    currentDicas.push(normalPool.pop());
                }
            }

            playerActionTaken = false;
            
            if (!keepPlayer) rotatePlayer();

            document.getElementById('clue-display').innerText = "Toque em um n√∫mero...";
            updateStatus();
            renderGrid();
        }

        function showEventInfo() {
            if (!currentEvent) return;
            const modal = document.getElementById('generic-modal');
            const title = document.getElementById('modal-title');
            const desc = document.getElementById('modal-desc');
            const actions = document.getElementById('modal-actions');
            const icon = document.getElementById('modal-icon');
            const inputArea = document.getElementById('modal-input-area');

            modal.classList.remove('hidden');
            inputArea.classList.add('hidden');

            icon.innerText = "‚ÑπÔ∏è";
            title.innerText = "INFO DO EVENTO";
            desc.innerText = eventDescriptions[currentEvent] || "Evento especial ativo.";
            
            actions.innerHTML = `
                <button onclick="document.getElementById('generic-modal').classList.add('hidden')" class="w-full bg-slate-700 text-white font-bold py-3 rounded-xl">ENTENDI</button>
            `;
        }

        function openBetModal() {
            stopTimer(); 
            const modal = document.getElementById('generic-modal');
            const title = document.getElementById('modal-title');
            const desc = document.getElementById('modal-desc');
            const actions = document.getElementById('modal-actions');
            const inputArea = document.getElementById('modal-input-area');
            const input = document.getElementById('modal-number-input');
            const icon = document.getElementById('modal-icon');

            modal.classList.remove('hidden');
            
            const activePlayers = players.filter(p => p.active);
            const minScore = Math.min(...activePlayers.map(p => p.score));
            const minPlayer = activePlayers.find(p => p.score === minScore);
            const maxBet = minPlayer.score - 1; 

            icon.innerText = "üí∞";
            title.innerText = "MODO APOSTA!";
            desc.innerText = `Aten√ß√£o ${minPlayer.name} (${minPlayer.score} pts), defina a aposta da rodada! (M√°x: ${maxBet})`;
            inputArea.classList.remove('hidden');
            input.value = "1";
            input.max = maxBet;
            
            actions.innerHTML = `
                <button onclick="confirmBet(${maxBet})" class="w-full bg-green-600 text-white font-bold py-3 rounded-xl">CONFIRMAR APOSTA</button>
            `;
        }

        function confirmBet(maxBet) {
            const input = document.getElementById('modal-number-input');
            let amount = parseInt(input.value) || 0;
            
            if (amount <= 0) {
                alert("A aposta deve ser de pelo menos 1 ponto!");
                return;
            }
            if (amount > maxBet) {
                alert(`Voc√™ n√£o pode apostar mais do que ${maxBet} pontos!`);
                return;
            }

            let totalPot = 0;
            players.forEach(p => {
                if(p.active) {
                    p.score -= amount;
                    totalPot += amount;
                }
            });

            betPot = totalPot;
            document.getElementById('pot-display').classList.remove('hidden');
            document.getElementById('pot-amount').innerText = betPot;
            document.getElementById('generic-modal').classList.add('hidden');
            document.getElementById('modal-input-area').classList.add('hidden');

            finishInitRound(false);
        }

        function updateEventUI() {
            const body = document.body;
            const banner = document.getElementById('event-display');
            const eventNameEl = document.getElementById('event-name');
            
            const eventNames = {
                'DOUBLE': 'PONTOS DOBRADOS (x2)',
                'TRIPLE': 'PONTOS TRIPLICADOS (x3)',
                'THIEF': 'RODADA DO LADR√ÉO üïµÔ∏è‚Äç‚ôÄÔ∏è',
                'LIMIT': 'LIMITE DE DICAS (5 APENAS)',
                'CHAOS': 'ORDEM ALEAT√ìRIA üé≤',
                'BET': 'MODO APOSTA üí∞',
                'UNDERDOG': 'AZAR√ÉO NO COMANDO üê¢',
                'CAPITALIST': 'LOJA ABERTA üõí',
                'BLIND': 'RODADA CEGA üôà'
            };

            if (currentEvent) {
                banner.classList.remove('hidden');
                eventNameEl.innerText = eventNames[currentEvent];
            } else {
                banner.classList.add('hidden');
            }
        }

        // --- TIMER LOGIC ---
        function startTimer() {
            if (configTimer <= 0) return;
            stopTimer(); 
            timeLeft = configTimer;
            updateTimerUI();

            const barFill = document.getElementById('timer-bar-fill');
            barFill.style.width = '100%';
            barFill.style.transition = 'none'; 
            void barFill.offsetWidth;
            barFill.style.transition = `width ${configTimer}s linear`;
            barFill.style.width = '0%';

            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer-text').innerText = `${timeLeft}s`;
                if (timeLeft <= 0) {
                    stopTimer();
                    handleTimeout();
                }
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = null;
            document.getElementById('timer-bar-fill').style.width = '100%'; 
            document.getElementById('timer-bar-fill').style.transition = 'none';
        }

        function updateTimerUI() {
            document.getElementById('timer-text').innerText = `${timeLeft}s`;
        }

        function handleTimeout() {
            playError();
            shakeScreen();
            const p = players[currentPlayerIdx];
            p.score -= 3;
            
            const modal = document.getElementById('generic-modal');
            const title = document.getElementById('modal-title');
            const desc = document.getElementById('modal-desc');
            const actions = document.getElementById('modal-actions');
            const icon = document.getElementById('modal-icon');

            modal.classList.remove('hidden');

            icon.innerText = "‚åõ";
            title.innerText = "TEMPO ESGOTADO!";
            desc.innerText = `${p.name} demorou demais e perdeu 3 pontos!`;
            actions.innerHTML = "";
            document.getElementById('modal-input-area').classList.add('hidden');

            setTimeout(() => {
                modal.classList.add('hidden');
                checkLoseCondition(p, true); 
            }, 2000);
        }

        function rotatePlayer() {
            // Check for Blind Mode Reset (Dicas voltam para baixo)
            if (currentEvent === 'BLIND') {
                const buttons = document.querySelectorAll('.card-num');
                buttons.forEach(b => b.classList.remove('revealed'));
                document.getElementById('clue-display').innerText = "Dicas Ocultas...";
            }

            const activePlayers = players.filter(p => p.active);
            if (activePlayers.length === 0) return;

            stopTimer();

            shopActionUsed = false;
            underdogClicks = 0;
            turnClicks = 0; // Reset do contador de cliques por turno

            if (currentEvent === 'CHAOS') {
                let available = activePlayers.filter(p => p.id !== players[currentPlayerIdx]?.id);
                if (available.length === 0) available = activePlayers; 
                
                const nextPlayer = available[Math.floor(Math.random() * available.length)];
                currentPlayerIdx = players.indexOf(nextPlayer);
            } else {
                do {
                    currentPlayerIdx = (currentPlayerIdx + 1) % players.length;
                } while (!players[currentPlayerIdx].active);
            }

            if (players[currentPlayerIdx].id === skipNextPlayerId) {
                skipNextPlayerId = null; 
                rotatePlayer(); 
                return;
            }

            updatePassButton();
            updateShopButtons();
            
            startTimer();
            updateStatus();
        }

        function updateStatus() {
            const container = document.getElementById('players-status');
            container.innerHTML = "";
            players.forEach((p, i) => {
                const isActive = (i === currentPlayerIdx);
                const isSkipped = (p.id === skipNextPlayerId);
                
                const div = document.createElement('div');
                let borderClass = 'border-slate-800/50 bg-slate-900/30';
                if (isActive) borderClass = 'active-player-border scale-105';
                if (isSkipped) borderClass = 'border-red-500 bg-red-900/20 opacity-70';

                const textColor = isActive ? 'var(--neon-theme)' : '#64748b';
                
                div.className = `p-3 rounded-2xl border-2 flex flex-col items-center transition-all ${borderClass} ${!p.active ? 'opacity-20 grayscale' : ''}`;
                
                div.innerHTML = `
                    <span class="text-[10px] font-orbitron font-bold tracking-widest truncate max-w-full" style="color: ${textColor}">
                        ${p.name} ${isSkipped ? '(PULADO)' : ''}
                    </span>
                    <div class="score-pill mt-1 ${p.score <= 2 && currentEvent !== 'BLIND' ? 'text-red-400 border-red-500/50' : ''}" style="${p.score > 2 && currentEvent !== 'BLIND' ? 'color:var(--neon-theme); border-color:var(--neon-theme)' : ''}">${p.score} PTS</div>
                    <div class="passes-pill">PULOS: ${p.passes}</div>
                `;
                container.appendChild(div);
            });
        }

        function renderGrid() {
            const grid = document.getElementById('grid-pistas');
            grid.innerHTML = "";
            const max = currentDicas.length; 

            for (let i = 1; i <= max; i++) {
                const b = document.createElement('button');
                b.className = "card-num h-14 rounded-2xl font-orbitron text-xl flex items-center justify-center text-white cursor-pointer relative";
                b.innerText = i;
                b.onclick = () => handleCardClick(b, i-1);
                grid.appendChild(b);
            }
        }

        function handleCardClick(btn, index) {
            if (btn.classList.contains('revealed')) return;

            const p = players[currentPlayerIdx];
            const isUnderdog = (currentEvent === 'UNDERDOG' && p.id === underdogId);
            
            // Defini√ß√£o de limites de clique
            let maxClicks = configEasyMode ? 3 : 1;
            if (isUnderdog) maxClicks = configEasyMode ? 4 : 2;

            if (turnClicks >= maxClicks) return;
            
            playClick();
            
            btn.classList.add('revealed');
            const clueText = currentDicas[index];
            document.getElementById('clue-display').innerText = `"${clueText}"`;
            
            // Adicionar ao hist√≥rico (Exceto no modo cego)
            if (currentEvent !== 'BLIND') {
                const histContainer = document.getElementById('history-container');
                const histList = document.getElementById('clue-history-list');
                histContainer.classList.remove('hidden');
                
                const pHist = document.createElement('p');
                pHist.className = "border-b border-white/5 pb-1 last:border-0";
                pHist.innerHTML = `<strong class="text-[var(--neon-theme)] mr-1">#${index+1}:</strong> ${clueText}`;
                histList.prepend(pHist);
            }

            turnClicks++;

            // Se atingir o limite, marca a√ß√£o como tomada para bloquear novas a√ß√µes (se houver l√≥gica futura de bloqueio total)
            if (turnClicks >= maxClicks) {
                playerActionTaken = true;
            }
        }

        function updateShopButtons() {
            const p = players[currentPlayerIdx];
            const btns = document.querySelectorAll('.shop-btn');
            btns.forEach(b => {
                b.disabled = shopActionUsed || p.score < 1; 
            });
        }

        function shopBuy(item) {
            const p = players[currentPlayerIdx];
            if (shopActionUsed) return;

            let cost = 0;
            if (item === 'skip' || item === 'clue') cost = 1;
            else cost = 2;

            if (p.score < cost) {
                alert("Pontos insuficientes!");
                return;
            }

            p.score -= cost;
            shopActionUsed = true;
            updateStatus();
            updateShopButtons();

            if (item === 'pass') {
                p.passes += 1;
                updateStatus();
            } else if (item === 'change') {
                initRound(true); 
            } else if (item === 'clue') {
                const unrevealed = Array.from(document.querySelectorAll('.card-num:not(.revealed)'));
                if (unrevealed.length > 0) {
                    const randomCard = unrevealed[Math.floor(Math.random() * unrevealed.length)];
                    randomCard.click();
                    // Comprar dica n√£o deve consumir clique do turno na l√≥gica original, mas reseta o contador se necess√°rio
                    // Na l√≥gica atual, o clique √© simulado, ent√£o consome o turnClicks.
                    // Para evitar que a compra bloqueie o jogador, reduzimos o contador:
                    turnClicks--; 
                }
            } else if (item === 'skip') {
                openSkipModal();
            }
        }

        function openSkipModal() {
            const modal = document.getElementById('generic-modal');
            const title = document.getElementById('modal-title');
            const desc = document.getElementById('modal-desc');
            const actions = document.getElementById('modal-actions');
            const icon = document.getElementById('modal-icon');

            modal.classList.remove('hidden');

            icon.innerText = "üö´";
            title.innerText = "ANULAR OPONENTE";
            desc.innerText = "Escolha quem perder√° a pr√≥xima vez:";
            actions.innerHTML = "";

            players.forEach(target => {
                if (target.id !== players[currentPlayerIdx].id && target.active) {
                    actions.innerHTML += `<button onclick="confirmSkip(${target.id})" class="w-full bg-slate-700 p-3 rounded-lg text-white font-bold">${target.name}</button>`;
                }
            });
        }

        function confirmSkip(targetId) {
            skipNextPlayerId = targetId;
            document.getElementById('generic-modal').classList.add('hidden');
            updateStatus();
        }

        function checkGuess() {
            playClick();
            stopTimer(); 

            const val = document.getElementById('guess-input').value;
            if (!val) return;
            const p = players[currentPlayerIdx];
            const isCorrect = (val === currentElement);

            if (currentEvent === 'THIEF') {
                if (isCorrect) showThiefModal('STEAL');
                else {
                    shakeScreen();
                    showThiefModal('GIVE');
                }
                return;
            }

            if (currentEvent === 'BET') {
                if (isCorrect) {
                    p.score += betPot;
                    betPot = 0;
                    checkWinCondition(p);
                } else {
                    shakeScreen();
                    nextTurn();
                }
                return;
            }

            let pointsGain = (currentEvent === 'DOUBLE') ? 2 : (currentEvent === 'TRIPLE') ? 3 : 1;
            
            if (isCorrect) {
                p.score += pointsGain;
                checkWinCondition(p);
            } else {
                shakeScreen();
                p.score -= 1;

                // Eliminar a op√ß√£o errada do select
                const select = document.getElementById('guess-input');
                const wrongOption = select.querySelector(`option[value="${val}"]`);
                if (wrongOption) wrongOption.remove();

                checkLoseCondition(p, true);
            }
        }

        function shakeScreen() {
            document.body.classList.add('apply-shake');
            setTimeout(() => document.body.classList.remove('apply-shake'), 400);
        }

        function showThiefModal(mode) {
            const modal = document.getElementById('generic-modal');
            const title = document.getElementById('modal-title');
            const desc = document.getElementById('modal-desc');
            const actions = document.getElementById('modal-actions');
            const icon = document.getElementById('modal-icon');

            modal.classList.remove('hidden');
            
            icon.innerText = "üïµÔ∏è‚Äç‚ôÄÔ∏è";
            
            const targets = players.filter((pl, idx) => idx !== currentPlayerIdx && pl.active);
            actions.innerHTML = "";

            if (mode === 'STEAL') {
                title.innerText = "ROUBAR PONTO!";
                desc.innerText = "Acertou! Escolha a v√≠tima:";
                if (targets.length === 0) {
                    desc.innerText = "Ningu√©m para roubar! Ganha 1 ponto normal.";
                    setTimeout(() => { modal.classList.add('hidden'); players[currentPlayerIdx].score += 1; checkWinCondition(players[currentPlayerIdx]); }, 2000);
                    return;
                }
            } else {
                title.innerText = "PAGAR PRENDA!";
                desc.innerText = "Errou! Doe seu ponto para:";
                if (targets.length === 0) {
                    desc.innerText = "Ningu√©m para doar! Perde 1 ponto normal.";
                    setTimeout(() => { modal.classList.add('hidden'); players[currentPlayerIdx].score -= 1; checkLoseCondition(players[currentPlayerIdx], true); }, 2000);
                    return;
                }
            }

            targets.forEach(target => {
                actions.innerHTML += `<button onclick="handleThiefAction('${mode}', ${target.id})" class="w-full bg-yellow-600 text-white font-bold py-3 rounded-lg">${target.name} (${target.score})</button>`;
            });
        }

        function handleThiefAction(mode, targetId) {
            const modal = document.getElementById('generic-modal');
            modal.classList.add('hidden');
            const p = players[currentPlayerIdx];
            const target = players.find(pl => pl.id === targetId);
            
            if (mode === 'STEAL') {
                target.score -= 1;
                p.score += 1;
                if (target.score <= 0) target.active = false;
                checkWinCondition(p);
            } else {
                p.score -= 1;
                target.score += 1;
                checkLoseCondition(p, true);
            }
            updateStatus();
        }

        function checkWinCondition(p) {
            if (p.score >= 10) {
                if (configReaper) {
                    // MODO CEIFADOR ATIVO
                    showReaperModal(p);
                } else {
                    showFinalWin(p);
                }
            } else {
                initRound(false);
            }
        }

        // --- REAPER LOGIC ---
        function showReaperModal(killer) {
            const modal = document.getElementById('generic-modal');
            const title = document.getElementById('modal-title');
            const desc = document.getElementById('modal-desc');
            const actions = document.getElementById('modal-actions');
            const icon = document.getElementById('modal-icon');

            modal.classList.remove('hidden');

            const targets = players.filter(p => p.id !== killer.id && p.active);

            // Se n√£o sobrar ningu√©m, venceu de qualquer jeito
            if (targets.length === 0) {
                showFinalWin(killer);
                return;
            }
            
            icon.innerText = "üíÄ";
            title.innerText = "HORA DA CEIFA!";
            desc.innerText = `Parab√©ns ${killer.name}! Voc√™ atingiu 10 pontos. Escolha uma v√≠tima para ELIMINAR permanentemente do jogo.`;
            actions.innerHTML = "";
            document.getElementById('modal-input-area').classList.add('hidden');

            targets.forEach(target => {
                actions.innerHTML += `<button onclick="handleReaperKill(${target.id})" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-lg uppercase border border-red-500">ELIMINAR ${target.name}</button>`;
            });
        }

        function handleReaperKill(targetId) {
            const modal = document.getElementById('generic-modal');
            modal.classList.add('hidden');
            
            const killer = players[currentPlayerIdx];
            const victim = players.find(p => p.id === targetId);
            
            victim.active = false;
            killer.score = 5; // Reseta para 5

            // Mostra mensagem de elimina√ß√£o
            alert(`${victim.name} FOI CEIFADO! ${killer.name} volta para 5 pontos.`);

            // Verifica se s√≥ sobrou o Killer
            const survivors = players.filter(p => p.active);
            if (survivors.length === 1) {
                showFinalWin(killer);
            } else {
                initRound(false); // Continua o jogo
            }
        }

        function checkLoseCondition(p, triggerNext) {
            if (p.score <= 0) {
                p.active = false;
                const survivors = players.filter(pl => pl.active);
                if(survivors.length === 1) { showFinalWin(survivors[0]); return; }
                if(survivors.length === 0) { showFinalWin(null); return; }
            }
            if (triggerNext) nextTurn();
        }

        function handlePass() {
            const p = players[currentPlayerIdx];
            if (p.passes > 0) { 
                p.passes -= 1; 
                nextTurn(); 
            } else {
                alert("Sem pulos restantes! Voc√™ deve arriscar (ou perder tempo).");
            }
        }

        function updatePassButton() {
            const btn = document.getElementById('btn-pass');
            const p = players[currentPlayerIdx];
            if (p.passes <= 0) { btn.disabled = true; btn.innerText = "SEM PULOS"; }
            else { btn.disabled = false; btn.innerText = "PASSAR VEZ"; }
        }

        function nextTurn() {
            playClick();
            stopTimer(); // Garante que parou
            playerActionTaken = false;
            document.getElementById('guess-input').value = "";
            document.getElementById('clue-display').innerText = "Toque em um n√∫mero...";
            rotatePlayer();
        }

        function showFinalWin(winner) {
            stopTimer();
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('players-status').classList.add('hidden');
            document.getElementById('event-display').classList.add('hidden');
            document.getElementById('shop-panel').classList.add('hidden');
            document.getElementById('pot-display').classList.add('hidden');
            document.getElementById('ref-modal').classList.add('hidden');
            document.getElementById('game-timer-wrapper').classList.add('hidden');
            
            const screen = document.getElementById('win-screen');
            screen.classList.remove('hidden');
            if (winner) {
                document.getElementById('winner-title').innerText = `${winner.name} VENCEU!`;
                document.getElementById('win-message').innerText = `O mestre da liga conquistou a vit√≥ria final. O √∫ltimo elemento era ${currentElement}.`;
            } else {
                document.getElementById('winner-title').innerText = `EMPATE T√âCNICO`;
                document.getElementById('win-message').innerText = `Todos foram eliminados.`;
            }
        }
        
        window.onload = () => { currentPlayerIdx = -1; };
    </script>
</body>
</html>
